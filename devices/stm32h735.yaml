_svd: ../svd/stm32h735.svd

# Merge the hundreds of individual bit fields into single fields for the
# crypt key/iv registers.
CRYP:
  "K[0123][LR]R":
    _merge:
      - "k*"
  "IV[01][LR]R":
    _merge:
      - "IV*"

# Fix invalid groupName
_modify:
  OctoSPII_O_Manager:
    groupName: OctoSPII_O_Manager
  DMAMUX3:
    name: DMAMUX2
    description: DMAMUX2
  ADC1:
    addressBlock:
      offset: 0x0
      size: 0x100
      usage: registers

"ADC*":
  _strip:
    - "ADC_"

CORDIC:
  _strip:
    - "CORDIC_"

FMAC:
  _strip:
    - "FMAC_"

# PWR block
PWR:
  CR3:
    _add:
      SDEXTHP:
        description: SMPS step-down converter forced ON and in High Power MR mode
        bitWidth: 1
        bitOffset: 3
      SDLEVEL:
        description: SMPS step-down converter voltage output level selection
        bitWidth: 2
        bitOffset: 4
      SDEXTRDY:
        description: SMPS step-down converter external supply ready
        bitWidth: 1
        bitOffset: 16
  WKUPCR:
    _delete:
      - WKUPC
    _add:
      WKUPC1:
        description: Clear Wakeup pin flag for WKUPC1
        bitWidth: 1
        bitOffset: 0
      WKUPC2:
        description: Clear Wakeup pin flag for WKUPC2
        bitWidth: 1
        bitOffset: 1
      WKUPC4:
        description: Clear Wakeup pin flag for WKUPC4
        bitWidth: 1
        bitOffset: 3
      WKUPC6:
        description: Clear Wakeup pin flag for WKUPC6
        bitWidth: 1
        bitOffset: 5
  WKUPFR:
    _delete:
      - WKUPF3
      - WKUPF5

# SYSCFG block
SYSCFG:
  _add:
    CFGR:
      description: Timer break lockup register
      addressOffset: 0x18
      resetValue: 0x00000000
      fields:
        PVDL:
          description: Programmable voltage detector lockup bit
          bitOffset: 2
          bitWidth: 1
        FLASHL:
          description: FLASH double error lockup bit
          bitOffset: 3
          bitWidth: 1
        CM7L:
          description: CPU lockup bit
          bitOffset: 6
          bitWidth: 1
        BKRAML:
          description: Backup RAM Double error lockup bit
          bitOffset: 7
          bitWidth: 1
        SRAM4L:
          description: SRAM4 Double error lockup bit
          bitOffset: 9
          bitWidth: 1
        SRAM2L:
          description: SRAM2 Double error lockup bit
          bitOffset: 11
          bitWidth: 1
        SRAM1L:
          description: SRAM1 Double error lockup bit
          bitOffset: 12
          bitWidth: 1
        DTCML:
          description: DTCM-RAM Double error lockup bit
          bitOffset: 13
          bitWidth: 1
        ITCML:
          description: ITCM-RAM Double error lockup bit
          bitOffset: 14
          bitWidth: 1
        AXIRAML:
          description: AXISRAM Double error lockup bit
          bitOffset: 15
          bitWidth: 1
    ADC2ALT:
      description: ADC2 internal input alternate connection
      addressOffset: 0x30
      resetValue: 0x00000000
      fields:
        ADC2_ROUT1:
          description: ADC2 V_INP17 alternate connection
          bitOffset: 1
          bitWidth: 1
        ADC2_ROUT0:
          description: ADC2 V_INP16 alternate connection
          bitOffset: 0
          bitWidth: 1
    UR18:
      description: SYSCFG user register 18
      addressOffset: 0x348
      access: read-only
      fields:
        CPU_FREQ_BOOST:
          description: CPU maximum frequency boost
          bitOffset: 0
          bitWidth: 1
  _delete:
    - UR8                       # Only one flash bank
    - UR9
    - UR10
  PMCR:
    _add:
      BOOSTVDDSEL:
        description: Analog switch supply voltage selection
        bitWidth: 1
        bitOffset: 9
      I2C5FMP:
        description: I2C5 Fm+
        bitWidth: 1
        bitOffset: 10
  UR0:
    _delete:
      - BKS
  UR11:
    _delete:
      - SA_END_2
  UR17:
    _add:
      TCM_AXI_SHARED_CFG:
        description: ITCM-RAM/AXI-SRAM size
        bitOffset: 16
        bitWidth: 2


# RCC block
RCC:
  _modify:
    # Fix reset values for these registers.
    # Note that the rename operation to remove C1 happens alongside this
    # modification, so we have to use the original names.
    C1_APB1LLPENR:
      resetValue: "0xE8FFCBFF"
    C1_APB4ENR:
      resetValue: "0x00010000"
    C1_APB4LPENR:
      resetValue: "0x0421DEAA"
  D1CCIPR:
    _modify:
      QSPISRC:
        name: OCTOSPISEL
  D2CCIP1R:
    _delete:
      - SAI23SRC
    _modify:
      SWPSRC:
        name: SWPMISEL
  D2CCIP2R:
    _modify:
      USART16SRC:
        name: USART16910SEL
      I2C123SRC:
        name: I2C1235SEL
  AHB3LPENR,C1_AHB3LPENR:
    _add:
      OCTOSPI1LPEN:
        description: OCTOSPI1 and OCTOSPI1 delay block enable during CSleep Mode
        bitWidth: 1
        bitOffset: 14
      OCTOSPI2LPEN:
        description: OCTOSPI2 and OCTOSPI2 delay block enable during CSleep Mode
        bitWidth: 1
        bitOffset: 19
  APB1LRSTR:
    _modify:
      HDMICECRST:
        name: CECRST
  APB1LENR:
    _modify:
      HDMICECEN:
        name: CECEN
  APB1HRSTR:
    _modify:
      SWPRST:
        name: SWPMIRST
  APB1HENR:
    _modify:
      SWPEN:
        name: SWPMIEN
  APB1HLPENR,C1_APB1HLPENR:
    _modify:
      SWPLPEN:
        name: SWPMILPEN

# OCTOSPI blocks
OCTOSPI?:
  DCR1:
    _modify:                    # Wider than in RM0455, where is it 3 bits
      CSHT:
        bitWidth: 6

_delete:
  - HRTIM                       # RM0468 devices do not have an HRTIM

SAI?:
  _strip:
    - SAI_

SDMMC?:
  _strip:
    - SDMMC_

MDIOS:
  _strip:
    - "MDIOS_"

TIM1:
  _modify:
    _interrupts:
      TIM_CC:
        name: TIM1_CC

DCMI:
  _modify:
    _interrupts:
      DCMI:
        name: DCMI_PSSI
        description: DCMI/PSSI global interrupt

RNG:
  _add:
    _interrupts:
      HASH_RNG:
        value: 80
        description: HASH OR RNG interrupt

LTDC:
  _add:
    _interrupts:
      LTDC_ERR:
        value: 89
        description: LCD-TFT global Error interrupt

RAMECC1:
  _add:
    _interrupts:
      ECC_DIAG_IT:
        value: 145
        description: ECC diagnostic global interrupt

# DTS peripheral is missing from the SVD.
# This interrupt is probably the one described as DTS-IT in the DTS docs.
#DTS:
#  _add:
#    _interrupts:
#      TEMP_IT:
#        value: 147
#        description: Temperature sensor global interrupt (also known as DTS-IT).

# OTFDEC peripheral is missing from the SVD.
#OTFDEC:
#  _add:
#    _interrupts:
#      OTFDEC1:
#        value: 151
#        description: OTFDEC1 interrupt
#      OTFDEC2:
#        value: 152
#        description: OTFDEC2 interrupt

# UART9 peripheral is missing from the SVD.
#UART9:
#  _add:
#    _interrupts:
#      UART9_IT_OR_UART9_WKUP:
#        value: 155
#        description: UART9 interrupt

# USART10 peripheral is missing from the SVD.
#USART10:
#  _add:
#    _interrupts:
#      USART10:
#        value: 156
#        description: USART10 interrupt

# I2C5 peripheral is missing from the SVD.
#I2C5:
#  _add:
#    _interrupts:
#      I2C5_EV:
#        value: 157
#        description: I2C5 event interrupt
#      I2C5_ER:
#        value: 158
#        description: I2C5 error interrupt

# FDCAN3 peripheral is missing from the SVD.
#FDCAN3:
#  _add:
#    _interrupts:
#      FDCAN3_IT0:
#        value: 159
#        description: FDCAN3 interrupt line 0
#      FDCAN3_IT1:
#        value: 160
#        description: FDCAN3 interrupt line 1

# Modify the DBGMCU.CR register fields names to be consistent with RM0468.
# TODO: Interesting aside: the svd lists these controls additionally for D2 and
#       D3, while the RM0468 specifies those as reserved bits, while still having
#       clock controls specified for D2, D3. Thus, it may not be unthinkable that
#       the same name changes need to be done for D2, D3, even though the reference
#       manual does not specify them. OR: perhaps remove the D2, D3 fields instead?
DBGMCU:
  CR:
    _modify:
      DBGSTBD1:
        name: DBGSTBY_D1
      DBGSTPD1:
        name: DBGSTOP_D1
      DBGSLPD1:
        name: DBGSLEEP_D1

# -----------------------------------------------------------------------------

_include:
 - ../peripherals/hdmi_cec.yaml
 - common_patches/rcc/h7_hsicfgr_csicfgr_735.yaml
 - common_patches/h7_common_singlecore.yaml
 - common_patches/fdcan/fdcan_h7.yaml
 - collect/fsmc/sdram.yaml
 - common_patches/rcc/h7_src_sel_common.yaml
 - common_patches/ethernet/h7_combined_desc.yaml
 - common_patches/exti/h7_singlecore.yaml
 - common_patches/dma/fcr_wo.yaml
 - common_patches/dma/bdma_v2_new.yaml
 - common_patches/dma/h7_dmacr.yaml
 - common_patches/dma/h7_dmamux.yaml
 - ../peripherals/dma/bdma.yaml
 - ../peripherals/dma/dma_v3.yaml
 - ../peripherals/dma/dmamux_v1.yaml
 - collect/dma/h7_dmamux.yaml
 - collect/dma/st.yaml
 - collect/dma/bdma.yaml
 - collect/dma/mdma.yaml
 - common_patches/dma/dma2d_v2.yaml
 - ../peripherals/dma/dma2d_v2.yaml
 - collect/hsem/r.yaml
 - common_patches/adc/h7.yaml
 - common_patches/adc/h7_boost_rev_v.yaml
 - common_patches/octospi/h7.yaml
 - common_patches/sai/h7.yaml
 - common_patches/sai/h7_mcken.yaml
 - common_patches/sai/sai_v1.yaml
 - ../peripherals/sai/sai.yaml
 - collect/sai/ch.yaml
 - collect/sai/pdm.yaml
 - common_patches/dfsdm/h735_747_753.yaml
 - collect/dfsdm/v1.yaml
 - common_patches/h7_spdifrx.yaml
 - common_patches/usb_otg/hs_v2.yaml
 - collect/usb_otg/hs.yaml
 - common_patches/flash/flash_dual_bank.yaml
 - collect/flash/bank.yaml
 - common_patches/i2c/merge_CR2_SADDx_fields.yaml
 - common_patches/usart/merge_CR1_DEATx_fields.yaml
 - common_patches/usart/merge_CR1_DEDTx_fields.yaml
 - common_patches/usart/merge_CR2_ABRMODx_fields.yaml
 - common_patches/usart/merge_CR2_ADDx_fields.yaml
 - common_patches/usart/rename_CR2_DATAINV_field.yaml
 - common_patches/usart/merge_BRR_fields.yaml
 - common_patches/tim/tim_o24ce.yaml
 - ../peripherals/adc/adc_v3_h7.yaml
 - ../peripherals/adc/adc_v3_common_h7.yaml
 - ../peripherals/adc/adc_h7_revision_v.yaml
 - ../peripherals/axi/axi_v1.yaml
 - common_patches/crc/crc_rename_init.yaml
 - ../peripherals/crc/crc_advanced.yaml
 - ../peripherals/crc/crc_idr_32bit.yaml
 - ../peripherals/crc/crc_pol.yaml
 - ../peripherals/gpio/v2/common.yaml
 - collect/gpio/v2.yaml
 - ../peripherals/lptim/lptim_v1.yaml
 - common_patches/ltdc/ltdc.yaml
 - ../peripherals/ltdc/ltdc.yaml
 - collect/ltdc/layer.yaml
 - ../peripherals/rcc/rcc_h7.yaml
 - ../peripherals/rcc/rcc_h7_revision_v.yaml
 - ../peripherals/rng/rng_v1.yaml
 - ../peripherals/rng/rng_v1_ced.yaml
 - ../peripherals/spi/spi_v3.yaml
 - common_patches/tim/v2/h7.yaml
 - common_patches/tim/common.yaml
 - common_patches/tim/tim2345_mixed_l.yaml
 - ../peripherals/tim/tim_basic.yaml
 - ../peripherals/tim/tim16.yaml
 - ../peripherals/tim/tim6.yaml
 - ../peripherals/tim/tim2345_mixed.yaml
 - ../peripherals/tim/tim_advanced.yaml
 - ../peripherals/tim/tim_h7.yaml
 - ../peripherals/tim/v2/ccm.yaml
 - collect/tim/ccr.yaml
 - ../peripherals/iwdg/iwdg_with_WINR.yaml
 - ../peripherals/exti/exti_h7.yaml
 - ../peripherals/i2c/i2c_v2.yaml
 - ../peripherals/wwdg/wwdg_v2.yaml
 - ../peripherals/usart/usart_v2B1.yaml
 - common_patches/rtc/alarm.yaml
 - common_patches/rtc/rtc_cr.yaml
 - ../peripherals/rtc/rtc_common.yaml
 - ../peripherals/rtc/rtc_h7.yaml
 - collect/rtc/alarm.yaml
 - collect/rtc/bkpr.yaml
 - common_patches/crc/h7_addr_fix.yaml
 - common_patches/wwdg/h7.yaml
 - common_patches/ethernet/h7_mac.yaml
 - ../peripherals/cordic/cordic_h7.yaml
